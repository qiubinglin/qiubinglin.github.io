---
layout:     post
title:      "Trading Algorithms"
date:       2024-04-15 21:40:00
author:     "Bing"
catalog:    true
tags:
    - OS
---

# 程序的典型内存布局
* 完整的内存空间布局
```
  高地址
  0xffffffffffffffff ─┬──────────────────────────────────────
                      │ 用户无法访问，通常为非法地址（防溢出）
                      │
                      │ 内核空间（所有进程共享）
                      │
  0xffffffffff000000 ─┬── 内核模块映射区（kernel modules）
                      │
                      │
  0xffffffffc0000000 ─┬── 内核代码段（kernel text, rodata）
                      │
                      │
  0xffff888000000000 ─┬── 物理内存线性映射区域（physmap）
                      │   = __PAGE_OFFSET，常用于直接访问物理内存
                      │
  0xffff800000000000 ─┬── vmalloc 区域（虚拟内核分配）
                      │
                      │
  ────────────────────┼──────────────────────────────────────
                      │ （用户空间与内核空间分界）
                      │
  0x0000800000000000 ─┬── 用户态最大地址（128 TiB 空间）
                      │
                      │
                      │ 用户空间（每个进程独立）
                      │
                      │
        ...           │
                      │
                      │
  0x0000000000400000 ─┬── 程序 text 段（代码段）
                      │
                      │
                      │ heap（brk 区）向高地址增长
                      │ mmap 区域（栈和堆之间）
                      │ 栈向低地址增长
                      │
  0x0000000000000000 ─┴── NULL 地址（访问非法，保护区）
```

* 用户空间内存布局
```
+--------------------------+ ← 低地址（0x0000...）
|    text (代码段)         |
+--------------------------+
|    data（全局已初始化数据）|
+--------------------------+
|    bss （全局未初始化数据）|
+--------------------------+
|    heap （动态内存）       | ← brk() 管理，向上增长
|        ↑ malloc/free     |
+--------------------------+
|                          |
| mmap 区域（共享库、匿名映射）|
|                          |
+--------------------------+
|    stack（栈，局部变量）   | ← 向下增长
+--------------------------+ ← 高地址（0xffff...）

```

# 内存映射管理
## mm_struct 结构体
mm_struct 描述了一个进程（或线程组）拥有的全部虚拟地址空间，包含页表、虚拟内存区域（VMA）链表/红黑树、栈、堆、mmap 区、代码段等的组织信息，是 Linux 内核中用户地址空间的“总管”

## vm_area_struct 结构体
这是 Linux 用来管理虚拟地址空间中某一段连续区域的核心数据结构，下面是源码中对结构体的说明

# 内存分配过程（malloc发生了什么）